<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.brand }} - Sneaker Shop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 0;
            margin-bottom: 2rem;
            border-radius: 10px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.5rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            margin: 0 1rem;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .nav-links a:hover {
            background: rgba(255,255,255,0.2);
        }

        .product-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .product-main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            padding: 2rem;
        }

        .product-image {
            height: 400px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8rem;
            color: #999;
        }

        .product-info h1 {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 1rem;
        }

        .product-price {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .product-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 1rem;
            display: inline-block;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .product-meta {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .meta-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #dee2e6;
        }

        .meta-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .meta-label {
            font-weight: bold;
            color: #495057;
        }

        .meta-value {
            color: #6c757d;
        }

        .product-tag {
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .product-tag small {
            opacity: 0.8;
        }

        .order-form {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .order-form h3 {
            color: #333;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .reviews-section {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .review-form {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .rating-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .rating-input input[type="radio"] {
            display: none;
        }

        .rating-input label {
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }

        .rating-input input[type="radio"]:checked ~ label,
        .rating-input label:hover {
            color: #ffc107;
        }

        .review-item {
            border-bottom: 1px solid #dee2e6;
            padding: 1rem 0;
            position: relative;
        }

        .review-item:last-child {
            border-bottom: none;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .review-author {
            font-weight: bold;
            color: #333;
        }

        .review-rating {
            color: #ffc107;
            font-size: 1.2rem;
        }

        .review-date {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .review-comment {
            color: #495057;
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }

        .review-actions {
            text-align: right;
        }

        .messages {
            margin-bottom: 1rem;
        }

        .alert {
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 0.5rem;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .no-data {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 2rem;
        }

        @media (max-width: 768px) {
            .product-main {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .nav-links {
                margin-top: 1rem;
            }
            
            .product-info h1 {
                font-size: 2rem;
            }
            
            .product-image {
                height: 250px;
                font-size: 4rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1>üëü Sneaker Shop</h1>
            <div class="nav-links">
                <a href="{% url 'home' %}">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                {% if user.is_authenticated %}
                    <a href="{% url 'profile' %}">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
                    <a href="{% url 'logout' %}">üö™ –í—ã–π—Ç–∏</a>
                {% else %}
                    <a href="{% url 'login' %}">üîë –í–æ–π—Ç–∏</a>
                    <a href="{% url 'register' %}">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                {% endif %}
            </div>
        </div>
    </header>

    <div class="container">
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <div class="product-container">
            <div class="product-main">
                <div class="product-image">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.brand }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
                    {% else %}
                        üëü
                    {% endif %}
                </div>
                
                <div class="product-info">
                    <h1>{{ product.brand }}</h1>
                    <div class="product-price">{{ product.price|floatformat:0 }} ‚ÇΩ</div>
                    
                    <div class="product-status {% if product.is_active %}status-active{% else %}status-inactive{% endif %}">
                        {% if product.is_active %}
                            ‚úÖ –í –Ω–∞–ª–∏—á–∏–∏
                        {% else %}
                            ‚ùå –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                        {% endif %}
                    </div>

                    <div class="product-meta">
                        <div class="meta-item">
                            <span class="meta-label">–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:</span>
                            <span class="meta-value">{{ product.created_at|date:"d.m.Y H:i" }}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">ID —Ç–æ–≤–∞—Ä–∞:</span>
                            <span class="meta-value">#{{ product.sneakers_id }}</span>
                        </div>
                        {% if review_stats.avg_rating %}
                        <div class="meta-item">
                            <span class="meta-label">–†–µ–π—Ç–∏–Ω–≥:</span>
                            <span class="meta-value">
                                {{ review_stats.avg_rating|floatformat:1 }}/5 
                                ({{ review_stats.total_reviews }} –æ—Ç–∑—ã–≤–æ–≤)
                            </span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö: –¢–µ–≥–∏ —Ç–æ–≤–∞—Ä–∞ -->
                    {% if product.tags.exists %}
                    <div class="product-meta" style="margin-top: 1rem;">
                        <h3 style="margin-bottom: 1rem; color: #333;">üè∑Ô∏è –¢–µ–≥–∏ —Ç–æ–≤–∞—Ä–∞</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            {% for product_tag in product.producttag_set.all %}
                                <span class="product-tag" data-color="{{ product_tag.tag.color }}">
                                    {{ product_tag.tag.name }}
                                    {% if product_tag.priority > 0 %}
                                        <small>({{ product_tag.priority }})</small>
                                    {% endif %}
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div style="margin-top: 1rem;">
                        {% if user.is_authenticated %}
                            <form method="post" action="{% url 'toggle_wishlist' product.sneakers_id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success">
                                    ‚ù§Ô∏è –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                                </button>
                            </form>
                            
                            {% if user.is_staff %}
                                <a href="{% url 'product_edit' product.sneakers_id %}" class="btn" style="margin-left: 0.5rem;">
                                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </a>
                            {% endif %}
                        {% endif %}
                    </div>

                    <!-- –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ -->
                    {% if user.is_authenticated and product.is_active %}
                    <div class="order-form">
                        <h3>üõí –ó–∞–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä</h3>
                        <form method="post" action="{% url 'create_order' product.sneakers_id %}">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                                <select name="quantity" id="quantity">
                                    <option value="1">1 –ø–∞—Ä–∞</option>
                                    <option value="2">2 –ø–∞—Ä—ã</option>
                                    <option value="3">3 –ø–∞—Ä—ã</option>
                                    <option value="4">4 –ø–∞—Ä—ã</option>
                                    <option value="5">5 –ø–∞—Ä</option>
                                </select>
                            </div>
                            <button type="submit" class="btn">
                                üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑
                            </button>
                        </form>
                    </div>
                    {% elif not user.is_authenticated %}
                    <div class="order-form">
                        <h3>üîë –î–ª—è –∑–∞–∫–∞–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</h3>
                        <a href="{% url 'login' %}" class="btn">–í–æ–π—Ç–∏</a>
                        <a href="{% url 'register' %}" class="btn" style="margin-left: 1rem;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤ -->
        <div class="reviews-section">
            <h2>üìù –û—Ç–∑—ã–≤—ã –æ —Ç–æ–≤–∞—Ä–µ</h2>
            
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ -->
            {% if user.is_authenticated %}
            <div class="review-form">
                <h3>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h3>
                <form method="post" action="{% url 'review_create' product.sneakers_id %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>–û—Ü–µ–Ω–∫–∞:</label>
                        <div class="rating-input">
                            <input type="radio" name="rating" value="5" id="star5">
                            <label for="star5">‚≠ê</label>
                            <input type="radio" name="rating" value="4" id="star4">
                            <label for="star4">‚≠ê</label>
                            <input type="radio" name="rating" value="3" id="star3">
                            <label for="star3">‚≠ê</label>
                            <input type="radio" name="rating" value="2" id="star2">
                            <label for="star2">‚≠ê</label>
                            <input type="radio" name="rating" value="1" id="star1">
                            <label for="star1">‚≠ê</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                        <textarea name="comment" id="comment" rows="4" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;" required></textarea>
                    </div>
                    <button type="submit" class="btn">
                        üìù –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
                    </button>
                </form>
            </div>
            {% else %}
            <div class="review-form">
                <p>–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <a href="{% url 'login' %}">–≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a></p>
            </div>
            {% endif %}

            <!-- –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ -->
            {% if reviews %}
                {% for review in reviews %}
                <div class="review-item">
                    <div class="review-header">
                        <div>
                            <span class="review-author">{{ review.client.full_name }}</span>
                            <span class="review-rating">
                                {% for i in "12345" %}
                                    {% if forloop.counter <= review.rating %}‚≠ê{% else %}‚òÜ{% endif %}
                                {% endfor %}
                            </span>
                        </div>
                        <span class="review-date">{{ review.created_date|date:"d.m.Y H:i" }}</span>
                    </div>
                    <div class="review-comment">{{ review.comment }}</div>
                    
                    <!-- –î–µ–π—Å—Ç–≤–∏—è —Å –æ—Ç–∑—ã–≤–æ–º –¥–ª—è –∞–≤—Ç–æ—Ä–∞ -->
                    {% if user.is_authenticated %}
                        {% with client_email=user.email %}
                            {% if review.client.email == client_email %}
                            <div class="review-actions">
                                <a href="{% url 'review_edit' review.review_id %}" class="btn" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">
                                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </a>
                                <a href="{% url 'review_delete' review.review_id %}" class="btn btn-danger" style="font-size: 0.8rem; padding: 0.25rem 0.5rem; margin-left: 0.5rem;">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </a>
                            </div>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="no-data">
                    –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!
                </div>
            {% endif %}
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ -->
        {% if product_card %}
        <div class="product-container">
            <div style="padding: 2rem;">
                <h2>üìã –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                <div class="product-meta">
                    <div class="meta-item">
                        <span class="meta-label">–ù–∞–∑–≤–∞–Ω–∏–µ:</span>
                        <span class="meta-value">{{ product_card.name }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                        <span class="meta-value">{{ product_card.category.get_name_display }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">–†–∞–∑–º–µ—Ä—ã:</span>
                        <span class="meta-value">{{ product_card.size }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">–¶–≤–µ—Ç:</span>
                        <span class="meta-value">{{ product_card.color }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">–ú–∞—Ç–µ—Ä–∏–∞–ª:</span>
                        <span class="meta-value">{{ product_card.material }}</span>
                    </div>
                    {% if product_card.description %}
                    <div class="meta-item">
                        <span class="meta-label">–û–ø–∏—Å–∞–Ω–∏–µ:</span>
                        <span class="meta-value">{{ product_card.description }}</span>
                    </div>
                    {% endif %}
                </div>
                
                
                <!-- ‚úÖ –ù–û–í–´–ô –ë–õ–û–ö: –°—Å—ã–ª–∫–∏ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω—ã -->
                {% if product_card.has_store_links %}
                <div style="margin-top: 2rem;">
                    <h3>üõí –ö—É–ø–∏—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞—Ö</h3>
                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-top: 1rem;">
                        {% for link_name, link_url in product_card.get_store_links %}
                            <a href="{{ link_url }}" 
                               target="_blank" 
                               rel="noopener noreferrer" 
                               class="btn"
                               style="margin-right: 1rem; margin-bottom: 0.5rem; display: inline-block;">
                                üõí {{ link_name }}
                            </a>
                        {% endfor %}
                        <div style="margin-top: 1rem; color: #666; font-size: 0.9rem;">
                            <small>‚ö†Ô∏è –°—Å—ã–ª–∫–∏ –≤–µ–¥—É—Ç –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ —Å–∞–π—Ç—ã. –ú—ã –Ω–µ –Ω–µ—Å–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–Ω–µ—à–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤.</small>
                        </div>
                    </div>
                </div>
                {% endif %}
                
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤ —Ç–µ–≥–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            const tags = document.querySelectorAll('.product-tag[data-color]');
            tags.forEach(tag => {
                tag.style.backgroundColor = tag.getAttribute('data-color');
            });
            
            // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∑–≤–µ–∑–¥–æ—á–∫–∞–º–∏
            const ratingInputs = document.querySelectorAll('.rating-input input[type="radio"]');
            const ratingLabels = document.querySelectorAll('.rating-input label');
            
            ratingLabels.forEach((label, index) => {
                label.addEventListener('mouseover', function() {
                    ratingLabels.forEach((l, i) => {
                        if (i >= index) {
                            l.style.color = '#ffc107';
                        } else {
                            l.style.color = '#ddd';
                        }
                    });
                });
                
                label.addEventListener('click', function() {
                    const input = document.getElementById(label.getAttribute('for'));
                    input.checked = true;
                });
            });
            
            document.querySelector('.rating-input').addEventListener('mouseleave', function() {
                const checkedInput = document.querySelector('.rating-input input[type="radio"]:checked');
                if (checkedInput) {
                    const checkedIndex = Array.from(ratingInputs).indexOf(checkedInput);
                    ratingLabels.forEach((l, i) => {
                        if (i >= checkedIndex) {
                            l.style.color = '#ffc107';
                        } else {
                            l.style.color = '#ddd';
                        }
                    });
                } else {
                    ratingLabels.forEach(l => l.style.color = '#ddd');
                }
            });
        });
    </script>
</body>
</html>